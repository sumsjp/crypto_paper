1. [摘要](#S1)
2. [研究角度](#S2)
3. [研究方法](#S3)
4. [研究結果](#S4)
5. [研究結論](#S5)

# (2024) An Improved Algorithm to Identify More Arbitrage Opportunities on Decentralized Exchanges

<a name="S1"></a>
## 1. **摘要**

在去中心化交易所 (DEXs) 中，套利機會主要以**套利迴路 (arbitrage loops)** 和 **非迴路套利 (non-loops arbitrage)** 兩種形式存在。例如，套利迴路指的是從某一幣種出發，經過多次交換後回到原幣種 (如 A → B → … → A)；而非迴路套利則是從一種幣種開始，最終停在不同的幣種 (如 A → B → … → N)。  

目前廣泛使用的 **Moore-Bellman-Ford (MBF) 演算法**（通常與“walk to the root”技術結合）可用於檢測 DEXs（如 Uniswap）的代幣交換圖中的套利迴路。然而，該演算法存在以下限制：
1. 每次運行只能識別有限數量的套利迴路；
2. 無法指定套利迴路的起始幣種；
3. 無法檢測任何兩種指定幣種之間的非迴路套利機會。

為解決這些問題，本研究提出了一種新方法，**結合線圖 (line graph) 和改進的 Moore-Bellman-Ford (MMBF) 演算法**，以增強套利檢測能力。此方法能夠：
- 在任意指定幣種的情況下，找到至少一條套利迴路；
- 檢測任何兩個幣種之間的非迴路套利機會。

本研究將該算法應用於 **Uniswap V2**，結果顯示，相較於 MBF 方法，本方法確實發現了更多套利迴路與非迴路套利機會，且部分套利路徑的潛在利潤甚至高達 **百萬美元**，遠超 MBF 方法所發現的套利利潤。此外，研究還對套利路徑長度分佈及套利利潤進行了統計比較，並分析了隨時間變化的套利機會分佈情況。  


<a name="S2"></a>
## 2. **研究角度**

1. **去中心化金融 (DeFi) 與去中心化交易所 (DEX) 的套利機制**  
   - 研究基於 **Uniswap V2** 的流動性池機制，分析如何利用價格差異來獲取套利機會。  
   - 探討 **常數乘積做市商 (CPMM, Constant Product Market Maker) 模型** 在套利過程中的作用。  

2. **算法優化與改進**  
   - 針對現有的 **Moore-Bellman-Ford (MBF) 演算法** 在檢測套利機會時的局限性，提出改進方法。  
   - **結合線圖 (Line Graph) 與改進的 Moore-Bellman-Ford (MMBF) 算法**，以提高套利檢測的全面性與效率。  

3. **套利機會類型與識別方法**  
   - 傳統 MBF 主要檢測 **套利迴路 (Arbitrage Loops)**，但本研究進一步擴展到 **非迴路套利 (Non-Loop Arbitrage)**，即不同幣種之間的套利機會。  
   - 提出新的演算法，能夠識別更多套利路徑，並且可指定套利迴路的起始幣種，提高檢測靈活性。  

4. **實證分析與數據驗證**  
   - 將新算法應用於 **Uniswap V2** 的歷史數據（2020 年 9 月 1 日至 2023 年 10 月 31 日），統計套利機會的數量與利潤分佈。  
   - **比較新算法與 MBF 方法的檢測效果**，發現新方法能夠找到更多套利機會，且部分套利路徑的利潤甚至可達 **百萬美元**。  

5. **時間序列與市場趨勢分析**  
   - 分析套利機會隨時間的變化趨勢，發現 Uniswap V2 的潛在套利利潤隨時間逐漸減少，反映出 **市場套利效率的提升**。  
   - 探討去中心化交易市場的發展趨勢，以及套利機會如何受到市場流動性、交易量、與 DeFi 生態系統變化的影響。  

6. **計算效率與實務應用**  
   - 研究演算法的執行效率，測試在含 **100 種代幣、約 400 個流動性池** 的代幣圖上執行所需時間約 **8-10 秒**，具備實際應用的潛力。  
   - 討論如何進一步優化演算法，使其在真實交易環境中更具時效性。  

7. **未來研究方向與局限性**  
   - 指出目前方法的不足之處，例如：
     - 尚未考慮 **鏈上交易的 Gas 費用**，這可能會影響實際套利利潤。  
     - 雖然可識別套利機會，但無法確保找到 **最優套利路徑**。  
   - 提出未來可改進之處，例如整合更高效的 **圖論優化算法**，或考慮 **Gas 費動態變化** 的影響。  

### **總結**  
本研究從 **DeFi 市場機制、套利檢測算法、數據實證、時間序列分析、計算效率、與市場發展趨勢** 等多個角度，提出一種更高效的套利檢測方法，並對其效果與市場影響進行了深入探討。


<a name="S3"></a>
## 3. **研究方法**

本研究主要採用以下方法來識別與分析套利機會：

#### **1. 數據處理 (Data Processing)**  
- **數據來源**：  
  - 研究使用來自 **Uniswap V2** 的數據，透過 **The Graph** 取得流動性池 (liquidity pools) 的詳細資訊，如代幣地址、名稱、儲備量等。  
  - 同時從**中心化交易所 (CEXs)** 獲取幣價，以計算跨市場套利機會。  
  - 分析的時間範圍涵蓋 **2020 年 9 月 1 日至 2023 年 10 月 31 日** 的歷史數據。  

- **代幣圖建構 (Token Graph Construction)**：  
  - 以代幣作為節點 (nodes)，以流動性池作為邊 (edges)，建構**代幣交換圖 (token graph)**。  
  - 篩選**總鎖倉價值 (TVL) 超過 2 萬美元**的流動性池，確保數據的代表性與計算效率。  
  - 為了降低計算量，最終選擇**前 100 個主要代幣及約 400 個流動性池**來進行分析。  

#### **2. 套利檢測方法 (Arbitrage Detection Methodology)**  
本研究的套利檢測方法包含以下四個步驟：

##### **(1) 構建線圖 (Line Graph Construction)**  
- 透過將 **代幣交換圖 (token graph)** 轉換為 **線圖 (line graph)**，確保能夠檢測更多套利機會。  
- 在線圖中，每條邊 (流動性池) 變成一個新節點，透過新的連接方式形成網絡，以捕捉更多套利路徑。  

##### **(2) 應用改進的 Moore-Bellman-Ford (MMBF) 演算法**  
- 傳統 MBF 只能檢測套利迴路，且運行一次僅能識別部分套利機會。  
- 本研究提出 **改進版 MMBF**，可：
  - **檢測從指定幣種開始的所有套利迴路**；
  - **識別任意兩個幣種間的套利機會**；
  - **降低計算時間，提高檢測效率**。  
- 透過在 **線圖 (L(G))** 中加入額外節點，使算法能夠一次性計算所有套利機會，而不需重複運行。  

##### **(3) 最大化套利利潤 (Optimizing Arbitrage Profit)**  
- 利用 **恆定乘積做市商 (CPMM) 模型** 計算最佳交易金額，確保套利利潤最大化。  
- 應用 **二分法 (Bisection Method)** 計算最佳初始投資金額，以獲取最優套利結果。  
- 研究發現套利利潤的函數為**凹函數 (concave function)**，因此可透過數值方法快速確定最優交易額度。  

#### **3. 統計分析與對比 (Statistical Analysis & Comparison)**  
- **套利機會數量對比**：  
  - 比較本研究方法與 MBF 方法識別出的套利機會數量。  
  - 結果顯示，本方法識別的套利機會數量遠高於 MBF 方法。  

- **套利路徑長度分佈**：  
  - 本研究方法檢測出的套利路徑長度分佈較為對稱，**多數套利路徑長度落在 7-11 之間**。  
  - MBF 方法主要檢測出**長度為 3 或 4 的套利路徑**，範圍較窄。  

- **套利利潤分佈**：  
  - 本研究方法發現的**最高套利利潤超過百萬美元**，遠超 MBF 方法（約十萬美元）。  
  - 檢測出的套利機會呈現**長尾分佈 (power-law distribution)**，大多數套利利潤介於 **數百至數千美元**。  

- **隨時間變化的套利機會**：  
  - 研究發現 **Uniswap V2 上的總套利利潤隨時間下降**，顯示市場效率有所提升。  
  - 在 2020 年底，套利利潤曾高達**千萬美元**，但至 2023 年 5 月，套利機會已降至**數十萬美元**的範圍。  

### **研究結果與應用意義**  
1. **新方法能夠更全面地識別套利機會**  
   - 可檢測所有套利迴路與非迴路套利，比 MBF 方法更有效。  
   - 可從**任意幣種開始**檢測套利路徑，適用於更廣泛的交易策略。  

2. **市場套利機會隨時間下降，顯示 DeFi 市場趨於有效**  
   - 統計結果顯示，套利機會總體呈下降趨勢，說明市場參與者正在利用這些套利機會，使市場變得更加高效。  

3. **方法可應用於實際交易環境**  
   - 在擁有 100 種代幣與 400 個流動性池的測試環境下，算法運行時間僅需 **8-10 秒**，適用於高頻交易。  
   - 進一步優化後，有望用於即時套利機會檢測。  

4. **未來研究方向**  
   - 目前算法雖能識別套利機會，但無法保證檢測到的套利路徑即為**最優套利路徑**，這將是未來研究的方向。  
   - 研究未考慮 **鏈上交易的 Gas 費用**，實際套利可能受 Gas 費用影響，因此未來應將 Gas 費納入套利成本計算模型。  

### **總結**  
本研究通過結合 **線圖技術 (Line Graph Approach)** 和 **改進的 MMBF 演算法**，顯著提升了 DEX 套利檢測的範圍與精度，並驗證了 Uniswap V2 隨時間套利機會的變化趨勢，為 DeFi 市場的套利交易提供了更有效的工具與理論支撐。


<a name="S4"></a>
## 4. **研究結果**

### **研究結果 (Research Results)**  

本研究的主要研究結果如下：  

### **1. 改進的套利檢測方法可識別更多套利機會**  
- **比 MBF 方法發現更多套利機會**：  
  - 本研究的方法可識別 **套利迴路 (arbitrage loops)** 和 **非迴路套利 (non-loop arbitrage)**，相比傳統 **Moore-Bellman-Ford (MBF) 結合 "walk to the root" 方法**，能夠發掘更多套利機會。  
  - 本方法能夠從**任意指定幣種**開始，檢測至少一條套利迴路，且可以識別**任何兩個幣種之間的非迴路套利機會**，而 MBF 方法無法做到這一點。  

- **套利機會數量顯著提升**：  
  - 研究顯示，使用 MBF 方法僅能識別出數百條套利路徑，而本研究的方法可識別出 **數萬條套利路徑**，覆蓋範圍更廣。  
  - 應用新方法後，檢測出的套利機會數量提升至 **MBF 方法的數十倍**，顯示出方法的有效性。  

### **2. 套利路徑長度分佈分析**  
- **本方法發現的套利路徑長度更符合市場特性**：  
  - **多數套利路徑長度介於 7-11 之間**，呈對稱分佈，顯示出市場中普遍存在較長的套利機會。  
  - **短套利路徑 (3-6) 及長套利路徑 (12-15) 亦占相當比例**，顯示出市場中套利機會的多樣性。  
  - **相比之下，MBF 方法大多僅能識別長度為 3 或 4 的套利迴路**，未能涵蓋更廣泛的套利機會。  

### **3. 套利利潤分佈分析**  
- **本研究方法能夠發現更高額的套利機會**：  
  - 研究發現，部分套利路徑的 **潛在套利利潤超過百萬美元**，遠超 MBF 方法所能檢測出的 **最高十萬美元** 水準。  
  - **套利利潤的分佈呈現長尾效應 (power-law distribution)**，大多數套利機會的利潤介於數百至數千美元。  
  - **23,868 條套利路徑的利潤超過 1,000 美元**，而 MBF 方法僅能檢測到 **19 條套利機會超過 1,000 美元**，顯示出本方法的優勢。  

### **4. 隨時間變化的套利機會分析**  
- **Uniswap V2 的套利機會隨時間下降，顯示市場效率提升**：  
  - 在 **2020 年底**，Uniswap V2 的總套利利潤曾高達 **千萬美元**，但隨著市場參與者增多，套利機會逐漸減少。  
  - **2023 年 5 月，市場中的套利機會大幅下降至約數十萬美元**，顯示市場價格發現機制逐漸趨於有效。  
  - **套利機會存在週期性變化**，可能與市場的交易量、流動性變動、DeFi 生態發展相關。  
  - **線性回歸分析顯示套利利潤隨時間緩慢下降 (回歸斜率約為 -0.002)**，表明市場套利機會正在被消耗，市場趨於更高效運作。  

### **5. 計算效率與實際應用價值**  
- **本方法運行時間短，可應用於即時套利檢測**：  
  - 在測試環境下 (包含 **100 種代幣與 400 個流動性池**)，本方法的運行時間僅需 **8-10 秒**，具備即時檢測套利機會的潛力。  
  - 若進一步優化算法，理論上可應用於**高頻交易**或**自動套利機器人**。  
  - **相比 MBF 方法，本方法在相同運算資源下可識別更多套利機會，且運行速度更快**。  

### **6. 未來研究方向與限制**  
- **套利路徑的最優性問題**：  
  - 雖然本方法能夠檢測套利機會，但無法保證發現的套利路徑為**最優套利路徑**，未來研究可進一步優化路徑選擇算法。  

- **未考慮鏈上交易的 Gas 費用**：  
  - 研究未考慮 **區塊鏈交易的 Gas 費用**，而 Gas 費對套利交易的影響很大。  
  - 未來可將 Gas 費用納入套利成本計算，並進一步優化交易策略。  
  

### **結論**  
本研究通過結合 **線圖技術 (Line Graph Approach
<a name="S5"></a>
## 5. **研究結論**

### **研究結論 (Conclusion)**  

本研究提出了一種改進的套利檢測方法，結合 **線圖技術 (Line Graph Approach)** 和 **改進的 Moore-Bellman-Ford (MMBF) 算法**，以解決傳統套利檢測方法（如 MBF 結合 "walk to the root" 技術）在識別套利機會上的局限性。通過對 **Uniswap V2** 的歷史數據分析，我們得出以下主要結論：

### **1. 改進的算法可識別更多套利機會**  
   - **識別範圍更廣**：與 MBF 方法相比，本研究的方法不僅可以發現 **套利迴路 (arbitrage loops)**，還能檢測 **非迴路套利 (non-loop arbitrage)**，即任何兩種代幣之間的套利機會。  
   -**可指定起始幣種**：本方法可以針對**任意指定幣種**，找到至少一條套利迴路，這是 MBF 方法無法實現的。  
     - **可檢測更多套利機會**：新方法發現的套利機會數量是 MBF 方法的 **數十倍**，顯示了其優勢。  

### **2. 套利機會數量與利潤分佈分析**  
   - **套利路徑長度更符合市場特性**：  
     - **多數套利路徑長度介於 7-11 之間**，顯示市場上存在較長的套利機會。  
     - 相較之下，MBF 方法大多僅能識別 **長度為 3 或 4 的套利迴路**，未能涵蓋完整套利機會範圍。  

   - **套利利潤更高，分佈呈長尾效應 (Power-law Distribution)**：  
     - **最高套利利潤超過百萬美元**，遠超 MBF 方法的 **十萬美元** 上限。  
     - **23,868 條套利機會的利潤超過 1,000 美元**，而 MBF 方法僅能檢測到 **19 條套利機會** 超過 1,000 美元。  

### **3. 市場套利機會隨時間減少，顯示 DeFi 市場趨於高效**  
   - **套利機會總體呈下降趨勢**：  
     - **2020 年底**，Uniswap V2 上的套利機會總額高達 **千萬美元**。  
     - **2023 年 5 月**，市場套利機會縮減至 **數十萬美元**，顯示市場價格發現機制的提升。  
     - **線性回歸分析顯示套利機會隨時間下降 (回歸斜率約為 -0.002)**，市場套利機會逐漸被套利者消耗，市場效率提升。  

#### **套利機會呈週期性變化**：  
   - 市場上的套利機會與流動性變動、交易量變化以及 DeFi 市場發展階段息息相關。  
   - 未來研究可進一步探討**流動性深度與套利機會之間的關聯**。  

### **4. 本方法可應用於即時套利檢測與交易**  
#### **運行時間短，適用於高頻交易**：  
   - 在包含 **100 種代幣與 400 個流動性池** 的測試環境下，**本方法運行時間僅需 8-10 秒**，顯示其適用於即時套利檢測。  
   - 若進一步優化，本方法可應用於 **套利機器人 (Arbitrage Bots) 或高頻交易系統**，提升 DeFi 市場效率。  

### **5. 研究限制與未來方向**  
   - **未考慮鏈上交易 Gas 費用**：  
     - 交易成本可能影響套利策略，未來應將 **Gas 費納入套利成本計算**，以提高套利機會的準確性。  

#### **套利路徑未必是最優解**：  
   - 本方法能夠檢測套利機會，但無法保證發現的套利路徑為**最優套利路徑**。未來研究可進一步優化 **動態規劃算法**，提高套利收益。  

### **研究結論總結**  
  - **本研究提出的改進算法，可識別更多套利機會，優於傳統 MBF 方法。**  
  - **市場套利機會隨時間減少，顯示 DeFi 市場趨於成熟與高效。**  
  - **本方法運行時間短，適用於高頻交易與套利機器人。**  
  - **未來可進一步考慮 Gas 費用影響，並優化套利路徑選擇。**  

### **應用價值與影響**  
  - **對套利交易者**：可發現更多套利機會，提升交易策略收益。  
  - **對 DeFi 研究者**：提供新穎套利檢測方法，有助於分析 DeFi 市場效率。  
  - **對市場機構與開發者**：可應用於**套利機器人、去中心化做市商 (DMM)**，提升市場流動性與價格發現機制。  

### **總結**  
本研究通過結合 **線圖技術 (Line Graph Approach)** 和 **改進的 MMBF 演算法**，成功提升了 **去中心化交易所 (DEXs) 套利檢測的範圍與精度**，並驗證了 **Uniswap V2 隨時間變化的套利趨勢**，為 **DeFi 市場的套利交易提供了更精確的檢測工具與理論支撐**。